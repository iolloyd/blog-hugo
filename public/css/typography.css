/* Enhanced Typography System
   Building on the Apple-inspired design with:
   - Content-specific typography scales
   - Variable font support with fallbacks
   - Vertical rhythm system
   - Accessibility features
*/

/* Variable Font Support */
@supports (font-variation-settings: normal) {
  @font-face {
    font-family: 'Inter var';
    font-style: normal;
    font-weight: 100 900;
    font-display: swap;
    src: url('../fonts/inter-var.woff2') format('woff2-variations');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  }
}

/* Enhanced Typography Variables with Fluid Scaling */
:root {
  /* Fluid typography using clamp() for responsive scaling */
  --fluid-text-xs: clamp(0.75rem, 0.5vw + 0.65rem, 0.875rem);
  --fluid-text-sm: clamp(0.875rem, 0.8vw + 0.75rem, 1rem);
  --fluid-text-base: clamp(1rem, 1vw + 0.875rem, 1.125rem);
  --fluid-text-lg: clamp(1.125rem, 1.5vw + 0.95rem, 1.375rem);
  --fluid-text-xl: clamp(1.25rem, 2vw + 1rem, 1.625rem);
  --fluid-text-2xl: clamp(1.5rem, 2.5vw + 1.25rem, 2rem);
  --fluid-text-3xl: clamp(1.875rem, 3vw + 1.5rem, 2.5rem);
  --fluid-text-4xl: clamp(2.25rem, 4vw + 1.75rem, 3.5rem);
  --fluid-text-5xl: clamp(2.75rem, 5vw + 2rem, 4.5rem);
  --fluid-text-6xl: clamp(3.5rem, 6vw + 2.5rem, 6rem);
  
  /* Content-specific fluid scales */
  --article-font-size: clamp(1.125rem, 1.5vw + 0.95rem, 1.25rem);
  --article-line-height: clamp(1.6, 0.5vw + 1.5, 1.75);
  --article-paragraph-spacing: clamp(1.25em, 1vw + 1em, 1.75em);
  --article-max-width: clamp(60ch, 10vw + 50ch, 75ch);
  
  /* Fluid heading scales */
  --heading-h1: clamp(2rem, 4vw + 1.5rem, 3.5rem);
  --heading-h2: clamp(1.75rem, 3vw + 1.25rem, 2.75rem);
  --heading-h3: clamp(1.5rem, 2.5vw + 1.125rem, 2.25rem);
  --heading-h4: clamp(1.25rem, 2vw + 1rem, 1.75rem);
  --heading-h5: clamp(1.125rem, 1.5vw + 0.95rem, 1.5rem);
  --heading-h6: clamp(1rem, 1vw + 0.875rem, 1.25rem);
  
  /* UI-specific typography */
  --ui-font-size: clamp(0.875rem, 0.8vw + 0.75rem, 1rem);
  --ui-line-height: 1.4;
  --ui-compact-size: clamp(0.75rem, 0.6vw + 0.65rem, 0.875rem);
  
  /* Navigation typography */
  --nav-font-size: clamp(1rem, 1vw + 0.875rem, 1.125rem);
  --nav-line-height: 1.2;
  --nav-letter-spacing: -0.01em;
  
  /* Flexible spacing using clamp */
  --baseline: clamp(0.25rem, 1vw + 0.125rem, 0.5rem);
  --baseline-2x: clamp(0.5rem, 2vw + 0.25rem, 1rem);
  --baseline-3x: clamp(0.75rem, 3vw + 0.375rem, 1.5rem);
  --baseline-4x: clamp(1rem, 4vw + 0.5rem, 2rem);
  --baseline-6x: clamp(1.5rem, 6vw + 0.75rem, 3rem);
  --baseline-8x: clamp(2rem, 8vw + 1rem, 4rem);
  
  /* Enhanced font stacks */
  --font-system-enhanced: 'Inter var', var(--font-system);
  --font-display: 'Inter Display var', 'Inter var', var(--font-system);
  --font-dyslexia: 'OpenDyslexic', 'Comic Sans MS', var(--font-system);
  
  /* Font loading states */
  --font-loaded: 0;
  
  /* Responsive margins and padding */
  --fluid-space-xs: clamp(0.25rem, 1vw, 0.5rem);
  --fluid-space-sm: clamp(0.5rem, 2vw, 1rem);
  --fluid-space-md: clamp(1rem, 3vw, 1.5rem);
  --fluid-space-lg: clamp(1.5rem, 4vw, 2.5rem);
  --fluid-space-xl: clamp(2rem, 6vw, 4rem);
  --fluid-space-xxl: clamp(3rem, 8vw, 6rem);
}

/* Font Loading Classes */
.fonts-loaded {
  --font-loaded: 1;
}

.fonts-loaded body {
  font-family: var(--font-system-enhanced);
}

/* Critical Input Field Sizing - Prevent iOS Zoom */
input[type="text"],
input[type="email"],
input[type="password"],
input[type="tel"],
input[type="url"],
input[type="search"],
input[type="number"],
input[type="date"],
input[type="time"],
select,
textarea {
  font-size: 16px !important; /* Never below 16px on mobile */
  line-height: 1.5;
}

/* Article Content Typography */
.article-content {
  font-size: var(--article-font-size);
  line-height: var(--article-line-height);
  font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.article-content p {
  margin-bottom: var(--article-paragraph-spacing);
  max-width: var(--article-max-width);
}

.article-content h1,
.article-content h2,
.article-content h3,
.article-content h4,
.article-content h5,
.article-content h6 {
  margin-top: var(--baseline-6x);
  margin-bottom: var(--baseline-3x);
  line-height: clamp(1.1, 0.5vw + 1.05, 1.25);
  font-weight: clamp(500, 10vw + 400, 600);
  letter-spacing: clamp(-0.025em, 0.1vw + -0.03em, -0.015em);
  font-family: var(--font-display);
}

.article-content h1 { 
  font-size: var(--heading-h1);
  font-weight: 700;
  letter-spacing: clamp(-0.03em, 0.1vw + -0.035em, -0.02em);
}

.article-content h2 { 
  font-size: var(--heading-h2);
  font-weight: 650;
}

.article-content h3 { 
  font-size: var(--heading-h3);
  font-weight: 600;
}

.article-content h4 { 
  font-size: var(--heading-h4);
  font-weight: 550;
}

.article-content h5 { 
  font-size: var(--heading-h5);
  font-weight: 500;
}

.article-content h6 { 
  font-size: var(--heading-h6);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: clamp(0.05em, 0.2vw + 0.03em, 0.1em);
}

.article-content blockquote {
  padding-left: var(--baseline-3x);
  margin: var(--baseline-4x) 0;
  border-left: 3px solid var(--apple-gray-light);
  font-style: italic;
}

.article-content code {
  font-family: var(--font-mono);
  font-size: 0.875em;
  padding: 0.125em 0.25em;
  background-color: var(--apple-gray-lighter);
  border-radius: 3px;
}

.article-content pre {
  margin: var(--baseline-4x) 0;
  padding: var(--baseline-2x);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Fluid UI Typography */
.ui-text {
  font-size: var(--fluid-text-base);
  line-height: clamp(1.3, 0.5vw + 1.2, 1.5);
  letter-spacing: normal;
}

.ui-text-compact {
  font-size: var(--fluid-text-sm);
  line-height: clamp(1.2, 0.5vw + 1.1, 1.4);
}

.ui-text-large {
  font-size: var(--fluid-text-lg);
  line-height: clamp(1.4, 0.5vw + 1.3, 1.6);
}

/* Fluid Navigation Typography */
.nav-text {
  font-size: var(--nav-font-size);
  line-height: var(--nav-line-height);
  letter-spacing: var(--nav-letter-spacing);
  font-weight: clamp(450, 5vw + 400, 500);
}

/* Fluid Utility Classes */
.text-fluid-xs { font-size: var(--fluid-text-xs); }
.text-fluid-sm { font-size: var(--fluid-text-sm); }
.text-fluid-base { font-size: var(--fluid-text-base); }
.text-fluid-lg { font-size: var(--fluid-text-lg); }
.text-fluid-xl { font-size: var(--fluid-text-xl); }
.text-fluid-2xl { font-size: var(--fluid-text-2xl); }
.text-fluid-3xl { font-size: var(--fluid-text-3xl); }
.text-fluid-4xl { font-size: var(--fluid-text-4xl); }
.text-fluid-5xl { font-size: var(--fluid-text-5xl); }
.text-fluid-6xl { font-size: var(--fluid-text-6xl); }

/* Fluid Vertical Rhythm Classes */
.rhythm-tight { margin-bottom: var(--baseline); }
.rhythm-normal { margin-bottom: var(--baseline-2x); }
.rhythm-relaxed { margin-bottom: var(--baseline-3x); }
.rhythm-loose { margin-bottom: var(--baseline-4x); }
.rhythm-extra-loose { margin-bottom: var(--baseline-6x); }
.rhythm-super-loose { margin-bottom: var(--baseline-8x); }

/* Fluid Spacing Utilities */
.space-fluid-xs { margin: var(--fluid-space-xs); }
.space-fluid-sm { margin: var(--fluid-space-sm); }
.space-fluid-md { margin: var(--fluid-space-md); }
.space-fluid-lg { margin: var(--fluid-space-lg); }
.space-fluid-xl { margin: var(--fluid-space-xl); }
.space-fluid-xxl { margin: var(--fluid-space-xxl); }

.padding-fluid-xs { padding: var(--fluid-space-xs); }
.padding-fluid-sm { padding: var(--fluid-space-sm); }
.padding-fluid-md { padding: var(--fluid-space-md); }
.padding-fluid-lg { padding: var(--fluid-space-lg); }
.padding-fluid-xl { padding: var(--fluid-space-xl); }
.padding-fluid-xxl { padding: var(--fluid-space-xxl); }

/* Accessibility Features */

/* Dyslexia Mode */
.dyslexia-mode {
  font-family: var(--font-dyslexia) !important;
  letter-spacing: 0.05em !important;
  word-spacing: 0.1em !important;
  line-height: 1.8 !important;
}

.dyslexia-mode p,
.dyslexia-mode li {
  margin-bottom: 1.5em !important;
}

/* Font Size Adjustments */
.font-size-small { font-size: 90% !important; }
.font-size-normal { font-size: 100% !important; }
.font-size-large { font-size: 110% !important; }
.font-size-xlarge { font-size: 125% !important; }

/* High Contrast Mode */
@media (prefers-contrast: high) {
  body {
    font-weight: 500;
  }
  
  .article-content {
    font-weight: 400;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  * {
    transition-duration: 0.01ms !important;
  }
}

/* Mobile-Specific Adjustments with Fluid Typography */
@media (max-width: 768px) {
  /* Ensure all interactive elements are touch-friendly */
  button,
  a,
  .clickable {
    min-height: 44px;
    display: inline-flex;
    align-items: center;
  }
  
  /* Article content adjustments - now fully fluid */
  .article-content {
    font-size: var(--article-font-size);
    line-height: var(--article-line-height);
  }
  
  /* Headings use fluid scales on mobile */
  .article-content h1 { 
    font-size: var(--heading-h1);
    margin-top: var(--fluid-space-xl);
    margin-bottom: var(--fluid-space-md);
  }
  
  .article-content h2 { 
    font-size: var(--heading-h2);
    margin-top: var(--fluid-space-lg);
    margin-bottom: var(--fluid-space-sm);
  }
  
  .article-content h3 { 
    font-size: var(--heading-h3);
    margin-top: var(--fluid-space-lg);
    margin-bottom: var(--fluid-space-sm);
  }
  
  .article-content h4 { 
    font-size: var(--heading-h4);
    margin-top: var(--fluid-space-md);
    margin-bottom: var(--fluid-space-xs);
  }
  
  /* Improved readability for long-form content */
  .article-content p {
    margin-bottom: var(--article-paragraph-spacing);
    text-align: left;
    hyphens: auto;
    -webkit-hyphens: auto;
    max-width: var(--article-max-width);
  }
  
  /* Better list spacing with fluid values */
  .article-content ul,
  .article-content ol {
    margin-bottom: var(--fluid-space-md);
    padding-left: clamp(1.25em, 3vw + 0.5em, 1.75em);
  }
  
  .article-content li {
    margin-bottom: var(--fluid-space-xs);
    line-height: var(--article-line-height);
  }
  
  /* Fluid blockquotes */
  .article-content blockquote {
    font-size: clamp(1rem, 2vw + 0.75rem, 1.125rem);
    padding-left: var(--fluid-space-md);
    margin: var(--fluid-space-lg) 0;
    line-height: clamp(1.6, 1vw + 1.4, 1.8);
  }
}

/* Smallest devices (iPhone SE) - Fluid adjustments */
@media (max-width: 375px) {
  :root {
    /* Override fluid values for very small screens */
    --article-font-size: clamp(1rem, 2vw + 0.85rem, 1.0625rem);
    --article-line-height: clamp(1.55, 1vw + 1.45, 1.7);
  }
  
  /* Ensure minimum readable sizes on tiny screens */
  .article-content h1 { 
    font-size: clamp(1.5rem, 4vw + 1.25rem, 1.875rem);
  }
  
  .article-content h2 { 
    font-size: clamp(1.25rem, 3vw + 1.125rem, 1.625rem);
  }
  
  .article-content h3 { 
    font-size: clamp(1.125rem, 2.5vw + 1rem, 1.375rem);
  }
  
  /* Tighter spacing on very small screens */
  .article-content p {
    margin-bottom: clamp(1.25em, 2vw + 1em, 1.5em);
  }
}

/* Enhanced fluid typography for different screen sizes */
@media (min-width: 1200px) {
  :root {
    /* Slightly larger scales for large screens */
    --article-font-size: clamp(1.25rem, 1vw + 1.125rem, 1.375rem);
    --article-line-height: clamp(1.65, 0.25vw + 1.6, 1.75);
    --article-max-width: clamp(65ch, 5vw + 60ch, 80ch);
  }
}

/* Container query support for typography */
@supports (container-type: inline-size) {
  .typography-container {
    container-type: inline-size;
  }
  
  @container (max-width: 480px) {
    .responsive-typography {
      font-size: var(--fluid-text-sm);
      line-height: 1.6;
    }
    
    .responsive-typography h1 {
      font-size: var(--fluid-text-xl);
    }
    
    .responsive-typography h2 {
      font-size: var(--fluid-text-lg);
    }
  }
  
  @container (min-width: 481px) {
    .responsive-typography {
      font-size: var(--fluid-text-base);
      line-height: 1.7;
    }
    
    .responsive-typography h1 {
      font-size: var(--fluid-text-2xl);
    }
    
    .responsive-typography h2 {
      font-size: var(--fluid-text-xl);
    }
  }
}